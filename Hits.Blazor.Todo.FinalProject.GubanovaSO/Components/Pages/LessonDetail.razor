@page "/lessons/{id:int}"
@using Hits.Blazor.Todo.FinalProject.GubanovaSO.Models
@inject NavigationManager Navigation

<PageTitle>Урок - Education Platform</PageTitle>

@if (lesson == null)
{
    <div class="container mt-5">
        <div class="alert alert-info">Загрузка урока...</div>
    </div>
}
else
{
    <div class="lesson-container">
        <div class="lesson-header">
            <h1>@lesson.Title</h1>
            <div class="lesson-breadcrumb">
                <a href="/courses/@lesson.CourseId" class="breadcrumb-link">Вернуться к курсу</a>
            </div>
        </div>

        <div class="lesson-content-wrapper">
            <div class="lesson-main">
                @if (!string.IsNullOrEmpty(lesson.VideoUrl))
                {
                    <div class="video-container">
                        <iframe src="@lesson.VideoUrl"
                                title="@lesson.Title"
                                allowfullscreen
                                class="video-player">
                        </iframe>
                    </div>
                }

                <div class="lesson-text">
                    <h2>Содержание урока</h2>
                    <p>@lesson.Content</p>
                </div>

                <div class="lesson-actions">
                    <button class="btn btn-success btn-lg" @onclick="MarkAsCompleted">
                        Отметить как завершённый
                    </button>
                    <button class="btn btn-outline-secondary btn-lg" @onclick="GoBack">
                        Назад
                    </button>
                </div>
            </div>

            <div class="lesson-sidebar">
                <div class="lesson-info-card">
                    <h3>Информация об уроке</h3>

                    <div class="info-item">
                        <span class="info-label">Статус:</span>
                        <span class="info-value">
                            @if (lesson.IsPublished)
                            {
                                <span class="badge bg-success">Опубликовано</span>
                            }
                            else
                            {
                                <span class="badge bg-warning">На модерации</span>
                            }
                        </span>
                    </div>

                    <div class="info-item">
                        <span class="info-label">Дата создания:</span>
                        <span class="info-value">@lesson.CreatedDate.ToString("dd.MM.yyyy")</span>
                    </div>

                    @if (lesson.UpdatedDate.HasValue)
                    {
                        <div class="info-item">
                            <span class="info-label">Обновлено:</span>
                            <span class="info-value">@lesson.UpdatedDate.Value.ToString("dd.MM.yyyy")</span>
                        </div>
                    }

                    <div class="completion-status">
                        <p>Прогресс: @completionPercentage%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: @completionPercentage%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .lesson-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .lesson-header {
        margin-bottom: 40px;
    }

        .lesson-header h1 {
            margin: 0 0 15px 0;
            color: #333;
        }

    .lesson-breadcrumb {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .breadcrumb-link {
        color: #667eea;
        text-decoration: none;
        font-size: 0.95rem;
    }

        .breadcrumb-link:hover {
            text-decoration: underline;
        }

    .lesson-content-wrapper {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 30px;
    }

    .lesson-main {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
    }

    .video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    .lesson-text {
        padding: 30px;
    }

        .lesson-text h2 {
            margin-top: 0;
            color: #333;
        }

        .lesson-text p {
            color: #666;
            line-height: 1.6;
        }

    .lesson-actions {
        padding: 30px;
        border-top: 1px solid #eee;
        display: flex;
        gap: 15px;
    }

    .btn-outline-secondary {
        border: 1px solid #ddd;
        color: #333;
        background: white;
    }

        .btn-outline-secondary:hover {
            border-color: #667eea;
            color: #667eea;
        }

    .lesson-sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .lesson-info-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

        .lesson-info-card h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 1rem;
        }

    .info-item {
        display: flex;
        flex-direction: column;
        margin-bottom: 15px;
    }

    .info-label {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
    }

    .info-value {
        color: #666;
        margin-top: 5px;
        font-size: 0.9rem;
    }

    .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.85rem;
        color: white;
        width: fit-content;
    }

    .bg-success {
        background: #28a745;
    }

    .bg-warning {
        background: #ffc107;
        color: #333;
    }

    .completion-status {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }

        .completion-status p {
            margin: 0 0 10px 0;
            font-weight: 600;
            color: #333;
        }

    .progress-bar {
        width: 100%;
        height: 10px;
        background: #eee;
        border-radius: 5px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s;
    }
</style>

@code {
    [Parameter]
    public int Id { get; set; }

    private Lesson? lesson;
    private int completionPercentage = 0;

    protected override async Task OnInitializedAsync()
    {
        lesson = new Lesson
        {
            Id = Id,
            Title = "Введение в программирование",
            Content = "Это содержимое урока. Здесь будет полный текст и материалы.",
            CourseId = 1,
            OrderNumber = 1,
            IsPublished = true,
            CreatedDate = DateTime.Now,
            VideoUrl = "https://www.youtube.com/embed/dQw4w9WgXcQ"
        };
    }

    private void MarkAsCompleted()
    {
        completionPercentage = 100;
    }

    private void GoBack()
    {
        if (lesson != null)
        {
            Navigation.NavigateTo($"/courses/{lesson.CourseId}");
        }
    }
}
