# üöÄ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö –ö–û–ú–ü–ò–õ–Ø–¶–ò–ò\n\n**–°–∫–æ–ø–∏—Ä—É–π —ç—Ç–∏ 3 —Ñ–∞–π–ª–∞ –∏ –∑–∞–º–µ–Ω–∏ Program.cs - –≥–æ—Ç–æ–≤–æ!**\n\n---\n\n## üìÅ –§–∞–π–ª 1: Components/Routes.razor\n\n```razor\n@using Microsoft.AspNetCore.Components.Routing\n\n<Router AppAssembly=\"@typeof(App).Assembly\">\n    <Found Context=\"routeData\">\n        <RouteView RouteData=\"@routeData\" DefaultLayout=\"@typeof(MainLayout)\" />\n        <FocusOnNavigate RouteData=\"@routeData\" Selector=\"h1\" />\n    </Found>\n    <NotFound>\n        <LayoutView Layout=\"@typeof(MainLayout)\">\n            <p role=\"alert\">–ò–∑–≤–∏–Ω–∏—Ç–µ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.</p>\n        </LayoutView>\n    </NotFound>\n</Router>\n```\n\n---\n\n## üìÅ –§–∞–π–ª 2: Components/Account/IdentityRevalidatingAuthenticationStateProvider.cs\n\n```csharp\nusing System.Security.Claims;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Components;\nusing Microsoft.AspNetCore.Components.Authorization;\n\nnamespace EducationPlatform.Components.Account\n{\n    public sealed class IdentityRevalidatingAuthenticationStateProvider : AuthenticationStateProvider\n    {\n        private readonly IServiceProvider _serviceProvider;\n        private readonly NavigationManager _navigationManager;\n\n        public IdentityRevalidatingAuthenticationStateProvider(\n            IServiceProvider serviceProvider,\n            NavigationManager navigationManager)\n        {\n            _serviceProvider = serviceProvider;\n            _navigationManager = navigationManager;\n        }\n\n        protected override async Task<AuthenticationState> GetAuthenticationStateAsync()\n        {\n            var anonymous = new ClaimsPrincipal(new ClaimsIdentity());\n            return await Task.FromResult(new AuthenticationState(anonymous));\n        }\n    }\n}\n```\n\n---\n\n## üìÅ –§–∞–π–ª 3: Program.cs (–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ú–ï–ù–ò –°–û–î–ï–†–ñ–ò–ú–û–ï!)\n\n```csharp\nusing Microsoft.AspNetCore.Components.Authorization;\nusing Microsoft.AspNetCore.Identity;\nusing Microsoft.EntityFrameworkCore;\nusing EducationPlatform.Components;\nusing EducationPlatform.Components.Account;\nusing EducationPlatform.Data;\nusing EducationPlatform.Models;\nusing EducationPlatform.Data.Services;\n\nvar builder = WebApplicationBuilder.CreateBuilder(args);\n\n// 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ë–î\nvar connectionString = builder.Configuration.GetConnectionString(\"DefaultConnection\")\n    ?? throw new InvalidOperationException(\"Connection string 'DefaultConnection' not found.\");\n\n// 2Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DbContext\nbuilder.Services.AddDbContext<ApplicationDbContext>(options =>\n    options.UseSqlServer(connectionString));\n\nbuilder.Services.AddDbContext<EducationDbContext>(options =>\n    options.UseSqlServer(connectionString));\n\n// 3Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Identity\nbuilder.Services.AddIdentityCore<ApplicationUser>(options =>\n{\n    options.SignIn.RequireConfirmedAccount = false;\n    options.Password.RequireDigit = false;\n    options.Password.RequireNonAlphanumeric = false;\n    options.Password.RequireUppercase = false;\n    options.Password.RequireLowercase = false;\n    options.Password.RequiredLength = 6;\n})\n.AddRoles<IdentityRole>()\n.AddEntityFrameworkStores<ApplicationDbContext>()\n.AddSignInManager()\n.AddRoleManager<RoleManager<IdentityRole>>()\n.AddDefaultTokenProviders();\n\n// 4Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Razor Components\nbuilder.Services.AddRazorComponents()\n    .AddInteractiveServerComponents();\n\n// 5Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤\nbuilder.Services.AddScoped<CourseService>();\nbuilder.Services.AddScoped<LessonService>();\nbuilder.Services.AddScoped<TestService>();\nbuilder.Services.AddScoped<EnrollmentService>();\nbuilder.Services.AddMemoryCache();\nbuilder.Services.AddHttpClient();\n\n// 6Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏\nbuilder.Services.AddCascadingAuthenticationState();\nbuilder.Services.AddScoped<IdentityRevalidatingAuthenticationStateProvider>();\nbuilder.Services.AddScoped<AuthenticationStateProvider>(sp =>\n    sp.GetRequiredService<IdentityRevalidatingAuthenticationStateProvider>());\n\nvar app = builder.Build();\n\n// 7Ô∏è‚É£ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–π\nusing (var scope = app.Services.CreateScope())\n{\n    var dbContext = scope.ServiceProvider.GetRequiredService<EducationDbContext>();\n    dbContext.Database.Migrate();\n\n    var roleManager = scope.ServiceProvider.GetRequiredService<RoleManager<IdentityRole>>();\n    string[] roles = { \"Admin\", \"Instructor\", \"Student\" };\n\n    foreach (var role in roles)\n    {\n        if (!await roleManager.RoleExistsAsync(role))\n        {\n            await roleManager.CreateAsync(new IdentityRole(role));\n        }\n    }\n}\n\n// 8Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware\nif (!app.Environment.IsDevelopment())\n{\n    app.UseExceptionHandler(\"/Error\", createScopeForErrors: true);\n    app.UseHsts();\n}\n\napp.UseHttpsRedirection();\napp.UseStaticFiles();\napp.UseRouting();\napp.UseAuthentication();\napp.UseAuthorization();\napp.UseAntiforgery();\n\n// 9Ô∏è‚É£ –ú–∞—Ä—à—Ä—É—Ç—ã\napp.MapRazorComponents<App>()\n    .AddInteractiveServerRenderMode();\n\napp.Run();\n```\n\n---\n\n## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å:\n\n1. **–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É** `Components/Account/` (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç)\n2. **–°–∫–æ–ø–∏—Ä—É–π –§–∞–π–ª 2** –≤ `Components/Account/IdentityRevalidatingAuthenticationStateProvider.cs`\n3. **–°–∫–æ–ø–∏—Ä—É–π –§–∞–π–ª 1** –≤ `Components/Routes.razor`\n4. **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏** `Program.cs` –Ω–∞ –§–∞–π–ª 3\n5. **–û—á–∏—Å—Ç–∫–∞:**\n   ```powershell\n   dotnet clean\n   dotnet build\n   ```\n6. **–ú–∏–≥—Ä–∞—Ü–∏—è:**\n   ```powershell\n   Add-Migration InitialCreate\n   Update-Database\n   ```\n\n---\n\n**–ì–æ—Ç–æ–≤–æ! üéâ**\n"